<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ImpulsaDBA</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-icons/bootstrap-icons.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="ImpulsaDBA.styles.css" rel="stylesheet" />
    <!-- QuillJS para editor de texto enriquecido -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
    <link href="manifest.webmanifest" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="./icons/icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="./icons/icon-192.png" />
    <meta name="theme-color" content="#03173d" />
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled exception has occurred. See browser console for details.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="_content/CurrieTechnologies.Razor.SweetAlert2/sweetAlert2.min.js"></script>
    <!-- QuillJS para editor de texto enriquecido -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        window.setupAyudasDropdown = (element, dotNetRef) => {
            const handleClickOutside = (event) => {
                if (element && !element.contains(event.target)) {
                    dotNetRef.invokeMethodAsync('CloseDropdown');
                }
            };
            
            document.addEventListener('click', handleClickOutside);
            
            // Guardar referencia para poder remover el listener despuÃ©s
            element._clickOutsideHandler = handleClickOutside;
        };
        
        window.removeAyudasDropdown = (element) => {
            if (element && element._clickOutsideHandler) {
                document.removeEventListener('click', element._clickOutsideHandler);
                delete element._clickOutsideHandler;
            }
        };

        // Inicializar instancias de Quill
        window.quillInstances = window.quillInstances || {};

        window.initQuillEditor = (editorId, dotNetRef, initialContent) => {
            if (typeof Quill === 'undefined') {
                console.error('QuillJS no estÃ¡ cargado');
                return;
            }

            const editorElement = document.getElementById(editorId);
            if (!editorElement) {
                console.error(`No se encontrÃ³ el elemento con ID: ${editorId}`);
                return;
            }

            // Si ya existe una instancia, destruirla primero
            if (window.quillInstances[editorId]) {
                delete window.quillInstances[editorId];
            }

            // Crear nueva instancia de Quill con barra de herramientas completa
            const quill = new Quill(`#${editorId}`, {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'align': [] }],
                        [{ 'indent': '-1'}, { 'indent': '+1' }],
                        [{ 'script': 'sub'}, { 'script': 'super' }],
                        ['link', 'image', 'video'],
                        ['code-block', 'blockquote'],
                        ['clean']
                    ]
                },
                placeholder: 'Escribe el contenido aquÃ­...'
            });

            // Establecer contenido inicial
            if (initialContent) {
                quill.root.innerHTML = initialContent;
            }

            // Escuchar cambios
            quill.on('text-change', function() {
                const content = quill.root.innerHTML;
                dotNetRef.invokeMethodAsync('OnEditorContentChanged', editorId, content);
            });

            // Guardar instancia
            window.quillInstances[editorId] = quill;
        };

        window.getQuillContent = (editorId) => {
            if (window.quillInstances[editorId]) {
                return window.quillInstances[editorId].root.innerHTML;
            }
            return '';
        };
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js', { updateViaCache: 'none' });
        }
    </script>
</body>

</html>
